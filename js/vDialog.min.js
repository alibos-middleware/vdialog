/*!
 * vDialog v1.0.0
 * HTML5 based javascript dialog plugin
 * https://www.qque.com/vDialog
 *
 * Copyright 2012-2015 pillys@163.com
 * Released under the MIT license
 */
(function(window,undefined){"use strict";var vDialog,zIndex=1e3,cache=[],template='    <div class="vdialog">      <div class="vd-header">        <div class="vd-title"></div>        <a class="vd-close" href="javascript:;">&times;</a>      </div>      <div class="vd-content"></div>      <div class="vd-footer"></div>    </div>';function VDialog(options){this.version="1.0.0";this.options=$.extend({id:"",title:"提示信息",content:"",init:null,ok:null,okValue:"确定",cancel:null,cancelValue:"取消",modal:false,close:null,esc:true,width:"auto",height:"auto",left:"auto",top:"auto"},options);this._eventQueue={};this._visible=true;return this._init()}VDialog.prototype._init=function(){var that=this,html=$(template);this.DOM={wrap:html,header:html.find(".vd-header"),title:html.find(".vd-header .vd-title"),close:html.find(".vd-header .vd-close"),content:html.find(".vd-content"),footer:html.find(".vd-footer"),modal:null};if(!this.options.id){this.options.id=Math.random()}this.title(this.options.title);this.ok(this.options.ok);this.cancel(this.options.cancel);this.close(this.options.close);this.width(this.options.width);this.height(this.options.height);this._esc();this._build();this.content(this.options.content);this.init(this.options.init);if(this.options.modal){this.showModal()}return this};VDialog.prototype.init=function(fn){this.options.init=fn;if(typeof fn==="function"){this.options.init.call(this)}return this};VDialog.prototype._build=function(){var wrap=this.DOM.wrap;this.DOM.close.on("click",function(){that.close()});wrap.css({zIndex:++zIndex});wrap.appendTo("body");cache.push({id:this.options.id,dialog:this});this._top();return this};VDialog.prototype.title=function(title){var toggleName="vd-header-no-title";if(title===true){this.DOM.title.show();this.DOM.header.removeClass(toggleName);return this}else if(title===false){this.DOM.title.hide();this.DOM.header.addClass(toggleName);return this}else if(typeof title==="string"){this.options.title=title;this.DOM.title.html(this.options.title);return this}else if(title===undefined){return this.options.title}return this};VDialog.prototype.content=function(content){if(content===undefined){return this.DOM.content}else{this.options.content=content;this.DOM.content.html(this.options.content);this.position();return this}};VDialog.prototype._button=function(name,fn){var that=this,button,buttonValue;button=that.button(name);if(name==="ok"){buttonValue="okValue"}else if(name==="cancel"){buttonValue="cancelValue"}else{return this}if(fn===undefined){button.trigger("click");return this}if(fn===null||fn===false){return this}if(button.length===0){that.button({name:name,className:name,text:that.options[buttonValue]})}that.button(name,function(){that.options[name]=fn;if(that.options[name]===true||that.options[name]&&that.options[name].call(that)!==false){that.close()}});return this};VDialog.prototype.ok=function(fn){return this._button("ok",fn)};VDialog.prototype.cancel=function(fn){return this._button("cancel",fn)};VDialog.prototype.button=function(button,fn){var that=this,footer,buttonDom,newButtonDom;footer=this.DOM.footer;if(fn===true){fn=function(){}}else if(fn===false){fn=function(){return false}}if(typeof button==="string"){buttonDom=footer.find('a.vd-btn[data-name="'+button+'"]');if(fn===undefined){return buttonDom}else{fn&&buttonDom.off("click.vDialog").on("click.vDialog",fn);return this}}else if(typeof button==="object"){button=$.extend({name:"",className:"ok",text:"确定"},button);if(button.name===""){button.name=Math.random().toString()}buttonDom=footer.find('a.vd-btn[data-name="'+button.name+'"]');newButtonDom=$('<a data-name="'+button.name+'" class="vd-btn vd-btn-'+button.className+'" href="javascript:;">'+button.text+"</a>");if(buttonDom.length===0){footer.prepend(newButtonDom)}else{buttonDom.replaceWith(newButtonDom)}fn&&newButtonDom.on("click.vDialog",fn);footer.show();return this}};VDialog.prototype.close=function(fn){var returnValue=null,returnDom;if(fn!==undefined){this.options.close=fn;if(this.options.close===false){this.DOM.close.hide()}else{this.DOM.close.show()}}else{returnDom=this.DOM.wrap.find('[data-returnable="true"]');if(returnDom.length>0){returnValue=returnDom.data("returnValue")||returnDom.val();this.returnValue=returnValue}this.DOM.wrap.remove();this.DOM.modal&&this.DOM.modal.remove();for(var i=0;i<cache.length;i++){if(cache[i].dialog===this){cache.splice(i,1);this._top();break}}if(typeof this.options.close==="function"){this.options.close.call(this)}}return this};VDialog.prototype.width=function(width){if(width===undefined){return this.options.width}else{this.options.width=width;this.DOM.content.width(this.options.width);this.position();return this}};VDialog.prototype.height=function(height){if(height===undefined){return this.options.height}else{this.options.height=height;this.DOM.content.height(this.options.height);this.position();return this}};VDialog.prototype.position=function(){var left,top,scrollSize,screenSize,dialogSize,el=document.documentElement||document.body;if(window.pageYOffset!==undefined){scrollSize={left:window.pageXOffset,top:window.pageYOffset}}else{scrollSize={left:el.scrollLeft,top:el.scrollTop}}screenSize={width:el.clientWidth,height:el.clientHeight};dialogSize={width:this.DOM.wrap.outerWidth(),height:this.DOM.wrap.outerHeight()};if(this.options.left==="auto"){left=scrollSize.left+Math.max(0,(screenSize.width-dialogSize.width)/2)}else{left=this.options.left}if(this.options.top==="auto"){top=scrollSize.top+Math.max(10,(screenSize.height-dialogSize.height)/3)}else{top=this.options.top}this.DOM.wrap.css({left:isNaN(left)?left:left+"px",top:isNaN(top)?top:top+"px"});return this};VDialog.prototype.show=function(anchor){this._visible=true;this.DOM.wrap.show();if(anchor){var anchor=$(anchor),offset=anchor.offset(),height=anchor.outerHeight(true);this.options.left=offset.left;this.options.top=offset.top+height;this.position()}this._top();return this};VDialog.prototype.showModal=function(anchor){var el=document.documentElement,height=Math.max(el.clientHeight,el.scrollHeight);this.DOM.modal=$("<div />").addClass("vdialog-modal").css({zIndex:zIndex,height:height}).insertBefore(this.DOM.wrap);this.show(anchor);return this};VDialog.prototype.hide=function(){this._visible=false;this.DOM.wrap.hide();this.DOM.modal&&this.DOM.modal.remove();this._top();return this};VDialog.prototype._top=function(){vDialog.top=null;for(var i=cache.length-1;i>=0;i--){if(cache[i].dialog._visible){vDialog.top=cache[i].dialog;break}}return this};VDialog.prototype._esc=function(){$(document).off("keydown.vDailog").on("keydown.vDailog",function(event){var dialog=vDialog.top,target=event.target;if(!dialog||/^input|textarea$/i.test(target.nodeName)&&target.type!=="button"){return}if(event.keyCode===27&&dialog.options.esc){dialog.close()}});return this};VDialog.prototype.on=function(name,fn){if(fn){if(this[name]){this[name].call(this,fn)}else{this._eventQueue[name]=fn}}return this};VDialog.prototype.emit=function(){var name,args=Array.prototype.slice.call(arguments);if(args.length===0){return this}name=args.shift();if(this._eventQueue[name]){this._eventQueue[name].apply(this,args)}return this};vDialog=function(options){return new VDialog(options)};vDialog.top=null;window.vDialog=vDialog})(window);